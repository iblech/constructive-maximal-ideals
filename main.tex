\documentclass[envcountsect,envcountsame,runningheads]{llncs}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amssymb,amsmath,mathtools}
\usepackage[protrusion=true,expansion=true]{microtype}

\newcommand{\aaa}{\mathfrak{a}}
\newcommand{\mmm}{\mathfrak{m}}
\newcommand{\nnn}{\mathfrak{n}}
\newcommand{\ppp}{\mathfrak{p}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\defeq}{\vcentcolon=}
\renewcommand{\_}{\mathpunct{.}\,}

\begin{document}

\title{Maximal ideals in countable rings, constructively}
\author{Ingo Blechschmidt\inst{1} \and Peter Schuster\inst{2}}
\institute{Universität Augsburg, Universitätsstr. 14, 86159 Augsburg, Germany
\email{ingo.blechschmidt@math.uni-augsburg.de}
\and Università di Verona, Strada le Grazie 15, 37134 Verona, Italy
\email{petermichael.schuster@univr.it}}

\maketitle

\begin{abstract}
  The existence of a maximal ideal in a general nontrivial commutative
  ring is tied together with the axiom of choice.
  Using the relative interpretation of
  negation (that is, as ``implies~$0=1$'') we show, in constructive set theory with
  minimal logic, how to do without any kind of choice in the case of countable rings. By a functional
  recursive definition we obtain an ideal such that the quotient is a residue field
  (every noninvertible element is zero), and under some decidability
  preconditions even a geometric field (every element is either invertible or
  else zero). Krull's lemma for the related notion of prime ideal follows by
  passing to rings of fractions. All this can be carried over to Heyting
  arithmetic with minimal logic, and to rings indexed by any well-founded set,
  and we show how a metatheorem of Joyal and Tierney can be used to expand our
  treatment to arbitrary rings. Along the way we do a case study for proofs in
  algebra with minimal logic.
\end{abstract}

Let~$A$ be a commutative ring with unit. The standard way of constructing a
maximal ideal of~$A$ is to apply Zorn's lemma to the set of proper ideals
of~$A$; but this method is less an actual construction and more an appeal to
the transfinite.

If~$A$ is countable with enumeration~$x_0,x_1,\ldots$, we can hope to provide a
more explicit construction by successively adding generators to the zero ideal,
skipping those which would render it improper:
\begin{align*}
  \mmm_0 &= \{ 0 \} &
  \mmm_{n+1} &= \begin{cases}
    \mmm_n + (x_n), & \text{if $1 \not\in \mmm_n + (x_n)$}, \\
    \mmm_n, & \text{else.}
  \end{cases}
\end{align*}
A maximal ideal is then obtained in the limit as the union of the intermediate
stages~$\mmm_n$. For instance, already Krull in his 1929 Annals contribution~\cite[Hilfssatz]{krull:ohne} and Mines, Richman and Ruitenburg in their book on constructive
algebra~\cite[Lemma~VI.3.2]{mines-richman-ruitenburg:constructive-algebra} proceed in this fashion,
and a similar
construction is used to concoct Henkin models for the purpose of proving
Gödel's completeness theorem for countable languages, successively adding
formulas which do not render the current set
inconsistent~\cite[Lemma~1.5.7]{dalen:logic},~\cite[Lemma~III.5.4]{simpson:subsystems}.

This procedure avoids any form of choice by virtue of being a
functional recursive definition, but still requires some form of omniscience in
order to carry out the case distinction.

The purpose of this text is to study a variant of this construction which
avoids any non-constructive principles. In this generality, the resulting
maximal ideal has an elusive quality to it, but useful properties can still be
extracted; and not only do we recover the original construction under certain
decidability assumptions, we can also exploit a relativity phenomenon of
mathematical logic in order to drop, with some caveats, the assumption that~$A$ is countable.

\paragraph{Conventions.} Throughout this note, we fix a ring~$A$.
In the spirit of Lombardi and Quitté~\cite{lombardi-quitte:constructive-algebra}, we employ \emph{minimal
logic}~\cite{johansson:minimal}, where by ``not~$\varphi$'' we mean~``$\varphi \Rightarrow 1 = 0 \in A$'', and do \emph{not} assume any form of the axiom of choice. Consequently,
by~``$x \not\in M$'' we mean~$x \in M \Rightarrow 1 = 0 \in A$, and a subset~$M
\subseteq A$ is \emph{detachable} if and only if for all~$x \in A$, either~$x \in M$
or~$x \not\in M$. For general background on constructive mathematics, we refer
to~\cite{bauer:five-stages,bauer:five-stages-talk,bauer:int-mathematics,sep:constructive-mathematics}.

For an arbitrary subset~$M \subseteq A$, not necessarily
detachable, the ideal~$(M)$ generated by~$M$ is given by~$\Bigl\{ \sum_{i=1}^n
a_i v_i \,\Big|\, n \geq 0, a_1,\ldots,a_n \in A, v_1,\ldots,v_n \in M \Bigr\}$.


\section{A construction}
\label{sect:constr}

We assume that the ring~$A$ is countable, with~$x_0, x_1, \ldots$ an
enumeration of the elements of~$A$. We do \emph{not} assume that~$A$ is
discrete (that is, that~$x = y$ or~$x \neq y$ for all elements of~$A$) or that
it is strongly discrete (that is, that finitely generated
ideals of~$A$ are detachable).

We study the following recursive construction of ideals~$\mmm_0, \mmm_1,
\ldots$ of~$A$:
\begin{align*}
  \mmm_0 &\defeq \{0\} &
  \mmm_{n+1} &\defeq \mmm_n + (\{ x_n \,|\, 1 \not\in \mmm_n + (x_n) \}).
\end{align*}
Finally, we set~$\mmm \defeq \bigcup_n \mmm_n$. The construction
of~$\mmm_{n+1}$ from~$\mmm_n$ is uniquely specified, requiring no choices of
any form.

The set~$M_n \defeq \{ x_n \,|\, 1 \not\in \mmm_n + (x_n) \}$ occurring in this
construction contains the element~$x_n$ if and only if~$1 \not\in \mmm_n +
(x_n)$; it is obtained from the singleton set~$\{x_n\}$ by bounded separation.
This set~$M_n$ is inhabited precisely if~$1 \not\in \mmm_n + (x_n)$, in which case~$\mmm_{n+1} = \mmm_n + (x_n)$.
However, in the generality we work in, we cannot assume that~$M_n$ is empty or
inhabited.

We can avoid the case distinction only by the flexibility of nondetachable
subsets, rendering it somewhat curious that -- despite the conveyed flavor of a
conjuring trick -- the construction can still be used to obtain concrete and
positive results. A similar construction has been studied by Herbelin and Ilik in the
context of Gödel's completeness theorem~\cite[p.~11]{herbelin-ilik:henkin}.

The ideal~$(M_n)$ is given by
$(M_n) = \{ a x_n \,|\, a = 0 \vee 1 \not\in \mmm_n + (x_n) \}$.

\begin{proposition}The subset~$\mmm$ is an ideal.
\end{proposition}

\begin{proof}Directed unions of ideals are ideals.\end{proof}

\begin{proposition}\label{prop:proper}
The ideal~$\mmm$ is \emph{proper} in the sense that~$1 \not\in \mmm$.\end{proposition}

\begin{proof}Assume~$1 \in \mmm$. Then~$1 \in \mmm_n$ for some number~$n \geq 0$. We
verify~$1 = 0$ by induction over~$n$.

If~$n = 0$, then~$1 \in \mmm_0 = \{0\}$. Hence~$1 = 0$.

If~$n > 0$, then~$1 = u + v x_{n-1}$ for some elements~$u,v \in A$ such that~$u
\in \mmm_{n-1}$ and such that~$v = 0$ or~$1 \not\in \mmm_{n-1} + (x_{n-1})$.
In the first case, we have~$1 = u \in \mmm_{n-1}$, hence~$1 = 0$ by the induction
hypothesis. In the second case we have~$1 = 0$ by modus ponens applied to the
implication~$1 \not\in \mmm_{n-1} + (x_{n-1})$ and the fact~$1 \in \mmm_{n-1} +
(x_{n-1})$ (which follows directly from the equation~$1 = u + v x_{n-1}$).
\end{proof}

\begin{lemma}\label{lemma:stage}
For every number~$n \in \NN$, the following are equivalent: \\
(1)~$x_n \in \mmm_{n+1}$.\quad
(2)~$x_n \in \mmm$.\quad
(3)~$1 \not\in \mmm + (x_n)$.\quad
(4)~$1 \not\in \mmm_n + (x_n)$.
\end{lemma}

\begin{proof}It is clear that~$(3) \Rightarrow (4) \Rightarrow (1) \Rightarrow
(2)$. It remains to show that~$(2) \Rightarrow (3)$.

Assume~$x_n \in \mmm$. In order to verify~$1 \not\in \mmm + (x_n)$,
assume~$1 \in \mmm + (x_n)$. Since~$\mmm + (x_n) \subseteq \mmm$,
we have~$1 \in \mmm$. Hence~$1 = 0$ by Proposition~\ref{prop:proper}.\end{proof}

\begin{proposition}\label{prop:is-maximal}The ideal~$\mmm$ is \emph{maximal} in the sense that it is proper and that for
all elements~$x \in A$, if $1 \not\in \mmm + (x)$, then~$x \in \mmm$.\end{proposition}

\begin{proof}Immediate by Lemma~\ref{lemma:stage}.\end{proof}

The first-order maximality condition of Proposition~\ref{prop:is-maximal} is
equivalent to the following higher-order version: For every ideal~$\nnn$ such that~$1
\not\in \nnn$, if~$\mmm \subseteq \nnn$, then~$\mmm = \nnn$.

\begin{corollary}The ideal~$\mmm$ is \emph{prime} in the sense that it is proper and that for
every elements~$x,y \in A$, if~$xy \in \mmm$ and~$x \not\in \mmm$, then~$y \in
\mmm$.\end{corollary}

\begin{proof}By maximality of~$\mmm$, it suffices to verify that~$1 \not\in
\mmm + (y)$. So assume~$1 \in \mmm + (y)$. Then~$x \in (x) \cdot \mmm + (xy)
\subseteq \mmm$ by~$xy \in \mmm$, hence~$x \in \mmm$, thus~$1 = 0$ by the assumption~$x \not\in
\mmm$.\end{proof}

\begin{corollary}The ideal~$\mmm$ is \emph{radical} in the sense that if~$x^k \in
\mmm$, then~$x \in \mmm$.\end{corollary}

\begin{proof}Let~$x^k \in \mmm$. Then~$1 \not\in \mmm + (x)$, for if~$1 \in
\mmm + (x)$, then also~$1 = 1^k \in (\mmm + (x))^k \subseteq \mmm + (x^k)
\subseteq \mmm$. Hence~$x \in \mmm$ by Lemma~\ref{prop:is-maximal}.\end{proof}

\begin{remark}The ideal~$\mmm$ is double negation stable in the sense that for every
ring element~$x$, if~$\neg\neg(x \in \mmm)$, then~$x \in \mmm$. This is because
by Lemma~\ref{lemma:stage} membership of~$\mmm$ is a negative condition
and~$\neg\neg\neg\varphi \Rightarrow \neg\varphi$ is a tautology of minimal
logic.\end{remark}

The quotient ring~$A/\mmm$ is a \emph{residue field} in that its unit is not
zero and every element which is not invertible is zero -- as with the real or
complex numbers.

\begin{example}The resulting maximal ideal~$\mmm$ depends on the chosen enumeration
of~$A$. For instance, if we enumerate~$\ZZ$ by~$0,1,-1,2,-2,\ldots$, the
ideal~$\mmm$ will coincide with~$(2)$. If the enumeration starts with some
prime number~$p$, the ideal~$\mmm$ will coincide with~$(p)$.\end{example}

\begin{example}If~$A$ is a local ring (in the sense that if a finite sum of ring
elements is invertible then one of the summands is), then~$\mmm = A \setminus
A^\times$.\end{example}

\begin{example}\label{ex:maximal-above}We can modify the construction by using an
arbitrary ideal~$\aaa$ as~$\mmm_0$ instead of the zero ideal. All results in
this section remain valid, provided ``not~$\varphi$'' is redefined
as~``$\varphi \Rightarrow 1\in\aaa$''; the resulting ideal~$\mmm$ is then a
maximal ideal above~$\aaa$; it is proper in the sense that~$1 \in \mmm
\Rightarrow 1 \in \aaa$. It can also be obtained by applying the original
version of the construction in the quotient ring~$A/\aaa$ (which is again
countable) and taking the inverse image of the resulting ideal along the
canonical projection~$A \to A/\aaa$.\end{example}

\begin{example}Assume that~$A$ is a field. Let~$f \in A[X]$ be a monic
polynomial of positive degree. Since~$f$ is monic, it is not invertible; thus
Example~\ref{ex:maximal-above} shows that there is a maximal ideal~$\mmm$
above~$(f)$. Hence~$A[X]/\mmm$ is a field in which~$f$ has a zero.
Iterating this construction, we obtain a splitting field of~$f$. No
assumption regarding decidability of reducibility has to be made, but in return
the resulting fields are only residue fields.\end{example}

If we can decide whether a finitely generated ideal contains the
unit or not, we can improve on this result. (For instance this is the case for
strongly discrete rings such as the ring~$\ZZ$, more generally for the ring of
integers of every number field, and for polynomial rings over discrete
fields~\cite[Theorem~VIII.1.5]{mines-richman-ruitenburg:constructive-algebra}.)

\begin{proposition}\label{prop:with-test}
Assume that for every finitely generated ideal~$\aaa \subseteq A$ we have~$1
\not\in \aaa$ or~$\neg(1 \not\in \aaa)$. Then:
\begin{enumerate}
\item Each ideal~$\mmm_n$ is finitely generated.
\item The ideal~$\mmm$ is detachable.
\end{enumerate}
If even~$1 \in \aaa$ or~$1 \not\in \aaa$ for every finitely generated ideal~$\aaa \subseteq
A$, then:
\begin{enumerate}
\addtocounter{enumi}{2}
\item The ideal~$\mmm$ is maximal in the strong sense that for every element~$x
\in A$,~$x \in \mmm$ or~$1 \in \mmm + (x)$, which is to say that the quotient ring~$A/\mmm$ is a
\emph{geometric field} (every element is zero or invertible).
\end{enumerate}
\end{proposition}

\begin{proof}We verify claim~$(1)$ by induction over~$n$. The case~$n = 0$ is
clear. Let~$n > 0$. By the induction hypothesis, the ideal~$\mmm_{n-1}$ is finitely
generated, hence so is~$\mmm_{n-1} + (x_{n-1})$. By assumption,~$1 \not\in \mmm_{n-1} +
(x_{n-1})$ or~$\neg(1 \not\in \mmm_{n-1} + (x_{n-1}))$. In the first
case~$\mmm_n = \mmm_{n-1} + (x_{n-1})$. In the second case~$\mmm_n =
\mmm_{n-1}$. In both cases
the ideal~$\mmm_n$ is finitely generated.

To verify claim~(2), let an element~$x_n \in A$ be given. By assumption,~$1
\not\in \mmm_n + (x_n)$ or~$\neg(1 \not\in \mmm_n + (x_n))$. Hence~$x_n \in
\mmm$ or~$x_n \not\in \mmm$ by Lemma~\ref{lemma:stage}.

For claim~(3), let an element~$x_n \in A$ be given. If~$1 \in \mmm_n + (x_n)$,
then also~$1 \in \mmm + (x_n)$. If~$1 \not\in \mmm_n + (x_n)$, then~$x_n \in
\mmm$ by Lemma~\ref{lemma:stage}.
\end{proof}

It is somewhat remarkable that under the assumption of Proposition~\ref{prop:with-test}, the ideal~$\mmm$ is detachable even though in
general it is not finitely generated. Usually in constructive mathematics, ideals which are not
finitely generated are seldom detachable. For instance the ideal~$\{ x \in
\ZZ \,|\, x = 0 \vee \varphi \} \subseteq \ZZ$ is detachable if and only
if~$\varphi \vee \neg\varphi$.

\begin{remark}\label{rem:via-generators}There is an equivalent description of the
maximal ideal~$\mmm$ which uses sets~$G_n$ of generators as proxies for the
intermediate ideals~$\mmm_n$:
\begin{align*}
  G_0 &\defeq \emptyset &
  G_{n+1} &\defeq G_n \cup \{ x_n \,|\, 1 \not\in (G_n \cup \{ x_n \}) \}
\end{align*}
An induction establishes the relation~$(G_n) = \mmm_n$; setting~$G \defeq
\bigcup_{n\in\NN} G_n$, the analogue of Lemma~\ref{lemma:stage} states
that for every number~$n \in \NN$, the following are equivalent:
(1)~$x_n \in G_{n+1}$.
(2)~$x_n \in G$.
(3)~$1 \not\in (G) + (x_n)$.
(4)~$1 \not\in (G_n) + (x_n)$.

In particular, not only do we have that~$(G) = \mmm$, but~$G$ itself is already
an ideal. This description of~$\mmm$ is in a sense more ``economical'' as the
intermediate stages~$G_n$ are smaller (not yet being ideals), enabling
arithmetization in Section~\ref{sect:arithmetization}.
\end{remark}

\newcommand{\rightrightharpoonup}{\mathrel{\mathrlap{\rightharpoonup}\mkern1mu\rightharpoonup}}
\begin{remark}All results in this section carry over mutatis mutandi if~$A$ is
only assumed to be subcountable, that is, if we are only
given a \emph{partially defined} surjection~$\NN \rightrightharpoonup A$. In
this case, we are given an enumeration~$x_0,x_1,\ldots$ where some~$x_i$
might not be defined; we then have to define~$\mmm_{n+1} \defeq
\mmm_n + (\{ x_n \,|\, \text{$x_n$ is defined} \wedge 1 \not\in \mmm_n + (x_n) \})$.
The generalization to the subcountable case is particularly useful in the
Russian tradition of constructive mathematics as exhibited by the ef{}fective
topos~\cite{hyland:effective-topos,oosten:realizability,phoa:effective,bauer:c2c},
where many rings of interest are subcountable, including uncountable ones such as the real
numbers~\cite[Prop.~7.2]{hyland:effective-topos}.
\end{remark}


\section{On the intersection of all prime ideals}

Classically, the intersection of all prime ideals is the
nilradical. In our setup, we have the following substitute concerning complements:
\[ \sqrt{(0)}^c =
  \bigcup_{\substack{\text{$\ppp \subseteq A$}\\\text{$\ppp$ prime}\\\text{$\ppp$ $\neg\neg$-stable}}} \ppp^c =
  \bigcup_{\substack{\text{$\ppp \subseteq A$}\\\text{$\ppp$ prime}\\\text{$\ppp$ radical}}} \ppp^c. \]

\begin{lemma}\label{lemma:x-prime}
Let~$x \in A$. Then there is an ideal~$\ppp \subseteq A$ which is
\begin{enumerate}
\item ``$x$-prime'' in the sense that
$1 \in \ppp \Rightarrow x \in \sqrt{(0)}$ and
$ab \in \ppp \wedge \bigl(b \in \ppp \Rightarrow x \in \sqrt{(0)}\bigr) \Longrightarrow
   a \in \ppp$,
that is, prime if the negations occurring in the definition of ``prime ideal''
are understood as~``$\varphi \Rightarrow x \in \sqrt{(0)}$'',
\item ``$x$-stable'' in the sense that
$\bigl((a \in \ppp \Rightarrow x \in \sqrt{(0)}) \Rightarrow x \in \sqrt{(0)}\bigr)
  \Rightarrow a \in \ppp$,
\item radical,
\item and such that~$x \in \ppp$ if and only if~$x$ is nilpotent.
\end{enumerate}
\end{lemma}

\begin{proof}The localization~$A[x^{-1}]$ is again countable, hence the
construction of Section~\ref{sect:constr} can be carried out to obtain a
maximal (and hence prime) ideal~$\mmm \subseteq A[x^{-1}]$. Every negation
occurring in the terms ``maximal ideal'' and ``prime ideal'' refers to~$1 = 0$
in~$A[x^{-1}]$, which is equivalent to~$x$ being nilpotent.

The preimage of~$\mmm$ under the localization homomorphism~$A \to A[x^{-1}]$ is
the desired~$x$-prime ideal.
\end{proof}

\begin{corollary}[Krull~\cite{krull:ohne}]\label{prop:nilp-prime}Let~$x \in A$ be an element which is not nilpotent. Then there is a
(radical and $\neg\neg$-stable) prime ideal~$\ppp \subseteq A$ such that~$x \not\in \ppp$.
\end{corollary}

\begin{proof}Because~$x$ is not nilpotent, the notion of an~$x$-prime ideal and
an ordinary prime ideal coincide. Hence the claim follows from
Lemma~\ref{lemma:x-prime}.\end{proof}

An important part of constructive algebra is to devise tools to import
proofs from classical commutative algebra into the constructive setting.
The following two statements are established test cases exploring the power of
such tools~\cite{schuster:induction,persson:constructive-spectrum,banaschweski-vermeulen:radical,coquand-lombardi:logical,coquand-lombardi-roy:dynamicalmethod}.

\begin{proposition}\label{prop:test-cases}Let~$f \in A[X]$ be a polynomial.
\begin{enumerate}
\item If~$f$ is nilpotent in~$A[X]$, then all coefficients of~$f$ are nilpotent in~$A$.
\item If~$f$ is invertible in~$A[X]$, then all coefficients of~$f$, except for
the constant coefficient, are
nilpotent in~$A$.
\end{enumerate}
\end{proposition}

These facts have abstract classical proofs which run as follows.

% NOTE FOR TYPESETTING: It is on purpose that we are not using the proof
% environment here, as we are quoting these classical proofs as objects of
% demonstration. We are not actually using these proofs in our development, we
% are just referencing them.
\begin{quote}\scriptsize
  \textbf{Proof of 1.} The claim follows from a simple induction if~$A$ is
  reduced. The general case reduces to this one: For every prime ideal~$\ppp$,
  the coefficients of~$f$ vanish over the reduced ring~$A/\ppp$. Hence they are
  contained in the intersection of all prime ideals and therefore
  nilpotent.\medskip

  \textbf{Proof of 2.} The claim follows from a simple induction if~$A$ is an
  integral domain. The general case reduces to this one: For every prime
  ideal~$\ppp$, the nonconstant coefficients of~$f$ vanish over the integral
  domain~$A/\ppp$. Hence they are contained in the intersection of all prime ideals
  and therefore nilpotent.
\end{quote}

Both statements admit direct computational constructive proofs which do not
refer to prime ideals; the challenge is not to find such proofs, but rather to
imitate these two given classical proofs constructively, staying as close as
possible to the original. It is remarkable that the construction of
Section~\ref{sect:constr} meets this challenge at all, outlined as follows, despite its fundamental
reliance on nondetachable subsets. We continue to assume that~$A$ is countable --
Section~\ref{sect:wlog} indicates how this assumption can be dropped.

\begin{proof}[of Proposition~\ref{prop:test-cases}]
The first claim follows from a simple induction if~$A$ is a reduced
ring.

In the general case, write~$f = a_n X^n + a_{n-1} X^{n-1} + \cdots + a_0$. Let~$\ppp$
be a radical~$a_n$-prime ideal as in Lemma~\ref{lemma:x-prime}. Since~$A/\ppp$
is reduced, the coefficient~$a_n$ vanishes over~$A/\ppp$. Thus~$a_n \in \ppp$,
hence~$a_n$ is nilpotent. Since the polynomial~$f - a_n X^n$ is again
nilpotent, we can continue by induction.

The second claim follows by a simple inductive argument if~$A$ is an
integral domain with double negation stable equality.

In the general case, write~$f = a_n X^n + \cdots + a_0$
and assume~$n \geq 1$. To reduce to the integral situation, let~$\ppp$ be
an~$a_n$-prime ideal as in Lemma~\ref{lemma:x-prime}. The quotient
ring~$A/\ppp$ is an~``$a_n$-integral domain'' with~``$a_n$-stable equality'';
understanding negation as~``$a_n$-negation'' (so interpreting~``$\neg\varphi$''
as~``$\varphi \Rightarrow a_n \in \sqrt{(0)}$''), we can regard~$A/\ppp$ more
simply as an ordinary integral domain with double negation stable equality.
Hence~$a_n = 0$ in~$A/\ppp$, so~$a_n \in \ppp$ whereby~$a_n$ is nilpotent. The
polynomial~$f - a_n X^n$ is again invertible in~$A[X]$ (since the group of
units is closed under adding nilpotent elements) so that we can continue by
induction.
\end{proof}

Just as Proposition~\ref{prop:nilp-prime} provides a constructive substitute
for the recognition of the intersection of all prime ideals as the nilradical,
the following proposition provides a constructive substitute for the
recognition of the intersection of all maximal ideals as the Jacobson radical.

As is customary in constructive
algebra~\cite[Section~IX.1]{lombardi-quitte:constructive-algebra}, we define
the Jacobson radical~$J$ as the ideal
$J \defeq \{ x \in A \,|\, \forall y \in A\_ 1 - xy \in A^\times \}$.
An element~$x$ is said to be \emph{apart from the Jacobson radical} if and only if
there exists an element~$y \in A$ such that~$1-xy$ is not invertible. In
general, this condition is stronger than~$x$ merely not being an element of~$J$.

\begin{proposition}Let~$x \in A$. If~$x$ is apart from the Jacobson radical, then
there is a maximal ideal~$\mmm$ such that~$x \not\in \mmm$.
\end{proposition}

\begin{proof}Since~$x$ is apart from~$J$, there is an element~$y \in A$ such that~$1-xy$
is not invertible. By Example~\ref{ex:maximal-above}, there is an ideal~$\mmm$
above~$\aaa \defeq (1-xy)$ which is maximal not only as an ideal of~$A/\aaa$
(where~``$\neg\varphi$'' means~``$\varphi \Rightarrow 1 \in \aaa$'') but also as an
ideal of~$A$ (where~``$\neg\varphi$'' means~``$\varphi \Rightarrow 1 = 0$''). If~$x
\in \mmm$, then~$1 = (1-xy) + xy \in \mmm$; hence~$x \not\in \mmm$.
\end{proof}


\section{In Heyting arithmetic}
\label{sect:arithmetization}

The construction presented in Section~\ref{sect:constr} crucially rests on the
flexibility of nondetachable subsets: In the absence of additional
assumptions as in Proposition~\ref{prop:with-test},
we cannot make do with decidable
predicates~$A \to \{0,1\}$; without additional hypotheses on~$A$, membership of the
ideals~$\mmm_n$ is not decidable. As such, the construction is
naturally formalized in intuitionistic set theories such as~\textsc{czf}
or~\textsc{izf}, which natively support such flexible subsets.

In this section, we explain how with some more care, the construction can also
be carried out in much weaker foundations such as Heyting
arithmetic~\textsc{ha}. While formulation in classical Peano arithmetic~\textsc{pa}
is routine, the development in~\textsc{ha} crucially rests on a specific
feature of the construction, namely that the condition for membership is a
negative condition.

To set the stage, we specify what we mean by a \emph{ring} in the context of
arithmetic. One option would be to decree that an arithmetized ring should be a single
natural number coding a finite set of ring elements and the graphs of the
corresponding ring operations; however, this perspective is too narrow, as we
also want to entertain infinite rings.

Instead, an arithmetized ring should be given by a ``formulaic setoid with ring
structure'', that is: by a formula~$A(n)$ with free
variable~$n$, singling out which natural numbers constitute
representatives of the ring elements; by a formula~$E(n,m)$ describing which
representatives are deemed equivalent; by a formula~$Z(n)$ singling out
representatives of the zero element; by a formula~$P(n,m,s)$ singling out
representatives~$s$ of sums; and so on with the remaining data constituting
a ring; such that axioms such as\par
{\vspace*{-1.2em}\small\begin{align*}
  \forall n\_ & Z(n) \Rightarrow A(n) && \text{``every zero representative belongs to the ring''} \\
  \exists n\_ & Z(n) && \text{``there is a zero representative''} \\
  \forall n,m\_ & Z(n) \wedge Z(m) \Longrightarrow E(n,m) && \text{``every two zero representatives are equivalent''} \\
  \forall z,n\_ & Z(z) \wedge A(n) \Longrightarrow P(z,n,n) && \text{``zero is neutral with respect to addition''}
\end{align*}}%
hold. This conception of arithmetized rings deviates from the usual definition
in reverse mathematics~\cite[Definition~III.5.1]{simpson:subsystems} to support
quotients even in case where Heyting arithmetic cannot verify the existence of
canonical representatives of equivalence classes.

Although first-order arithmetic cannot quantify over ideals of arithmetized
rings, specific ideals can be given by formulas~$I(n)$ such that axioms such that
{\small\begin{align*}
  \forall n\_ & I(n) \Rightarrow A(n) && \text{``$I \subseteq A$''} \\
  \exists n\_ & Z(n) \Rightarrow I(n) && \text{``$0 \in I$''}
\end{align*}}%
hold. It is in this sense that we are striving to adapt the construction of
Section~\ref{sect:constr} to describe a maximal ideal.

In this context, we can arithmetically imitate any set-theoretic description of
a single ideal as a subset cut out by an explicit first-order formula. However, for
recursively defined families of ideals, we require a suitable recursion
theorem: If we are given (individual formulas~$M_i(x)$ indexed by numerals
representing) ideals~$\mmm_0,\mmm_1,\mmm_2,\ldots$, we cannot generally
form~$\bigcup_{n\in\NN} \mmm_n$, as the naive formula~``$\bigvee_{n\in\NN} M_n(x)$''
representing their union would have infinite length. We can take the union only
if the family is \emph{uniformly represented} by a formula~$M(n,x)$ (denoting
that~$x$ represents an element of~$\mmm_n$).

Here we encounter a stumbling block in arithmetizing the
construction of the chain~$\mmm_0 \subseteq \mmm_1 \subseteq \cdots$
of Section~\ref{sect:constr}. Because~$\mmm_n$ occurs in the
definition of~$\mmm_{n+1}$ in negative position, naive arithmetization
results in formulas of unbounded logical complexity, suggesting that
a uniform definition might not be possible.

This issue is also noted, though not resolved, in related work on a
constructive version of Gödel's completeness
theorem~\cite[p.~11]{herbelin-ilik:henkin}.
The issue does not arise in the context of~\textsc{pa}, where the law of
excluded middle allows us bound the logical complexity: We can blithely define
the joint indicator function~$g(n,i)$ for the sets~$G_n$ (such that~$G_n = \{
x_i \,|\, i \in \NN, g(n,i) = 1 \}$) of Remark~\ref{rem:via-generators} by the recursion
\begin{align*}
  g(0,i) &= 0 \\
  g(n+1,i) &= \begin{cases}
    1, & \text{if $g(n,i) = 1 \vee (i = n \wedge 1 \not\in
    (g(n,0)x_0,\ldots,g(n,n-1)x_{n-1},x_n))$} \\
    0, & \text{else.}
  \end{cases}
\end{align*}
This recursion can be carried out within~\textsc{pa} since the recursive step
only references the finitely many values~$g(n,0),\ldots,g(n,i)$.
Heyting arithmetic, however, does not support this case distinction. The
formalization of the construction in~\textsc{ha} is only unlocked by the following
direct characterization.

\begin{lemma}\label{lemma:uniform-char}(In the situation of Remark~\ref{rem:via-generators}.)
For every finite binary sequence~$v = [v_0,\ldots,v_{n-1}]$, set~$\aaa_v
\defeq (v_0x_0,\ldots,v_{n-1}x_{n-1},x_n)$. Then:
\begin{enumerate}
\item For every such sequence~$v = [v_0,\ldots,v_{n-1}]$, if
$\bigwedge_{i=0}^{n-1} (v_i = 1 \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]})$,
then~$\aaa_v = (G_n) + (x_n)$.
In particular, in this case we have~$x_n \in G$ if and only if~$1 \not\in \aaa_v$.
\item For every natural number~$n \in \NN$,
\vspace*{-1.2em}
\[ x_n \in G \quad\Longleftrightarrow\quad \neg
  \exists v \in \{0,1\}^n\_
    1 \in \aaa_v \wedge
      \bigwedge_{i=0}^{n-1} (v_i = 1 \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]}). \]
\end{enumerate}
\end{lemma}

\begin{proof}The first part is by induction, employing the equivalences of
Remark~\ref{rem:via-generators}. The second rests on the tautology
$\neg\alpha \Longleftrightarrow \neg(\alpha \wedge (\varphi \vee \neg\varphi))$:

\vspace*{-1.2em}\small
\begin{align*}
  &\mathrel{\phantom{\Longleftrightarrow}} x_n \in G \\
  &\Longleftrightarrow \neg\bigl(1 \in (G_n) + (x_n)\bigr) \\
  &\Longleftrightarrow \neg\bigl(1 \in (G_n) + (x_n) \ \wedge\ \bigwedge_{i=0}^{n-1} (x_i \in G \vee x_i \not\in G)\bigr) \\
  &\Longleftrightarrow \neg\exists v \in \{0,1\}^n\_
    \Bigl(1 \in (G_n) + (x_n) \ \wedge\ \bigwedge_{i=0}^{n-1} (v_i = 1
    \Leftrightarrow x_i \in G)\Bigr) \\
  &\Longleftrightarrow \neg\exists v \in \{0,1\}^n\_
    \Bigl(1 \in \aaa_v \ \wedge\ \bigwedge_{i=0}^{n-1} (v_i = 1
    \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]})\Bigr) %\qedhere
\end{align*}
\end{proof}

Condition~(2) in Lemma~\ref{lemma:uniform-char} is manifestly formalizable in
arithmetic, uniformly in~$n$.


\section{Generalization to the well-founded case}

In this section, we relax the assumption that the ring~$A$ is countable to the
assumption that~$A$ is the image of a well-founded set~$I$. There are several
definitions of well-foundedness in the literature [XXX cite]; we require
transfinite recursion and induction over~$I$, and that both~$I$ and every subset
of the form~${{\downarrow}(n)} \defeq \{k \in I \,|\, k < n\}$ which is inhabited is directed. The
latter condition is for instance satisfied if~$({<})$ is a linear order.

Writing~$A = \{ x_n \,|\, n \in I \}$, we recursively construct
ideals~$(\mmm_n)_{n \in I}$ by
\begin{align*}
  \mmm_n &\defeq \mmm_{<n} + (\{ x_n \,|\, 1 \not\in \mmm_{<n} + (x_n) \}),
\end{align*}
where~$\mmm_{<n} \defeq \sum_{k < n} \mmm_k$. We set~$\mmm \defeq \bigcup_{n
\in I} \mmm_n$. As before, no choices of any kind are required.

\begin{proposition}\begin{enumerate}
\item The set~$\mmm$ is an ideal.
\item The ideal~$\mmm$ is proper.
\item For an element~$x_n \in A$, the following are equivalent: (a) $x_n \in
\mmm_n$; (b) $x_n \in \mmm$; (c) $1 \not\in \mmm + (x_n)$; (d) $1 \not \in \mmm_{<n} + (x_n)$.
\item The ideal~$\mmm$ is maximal (and hence prime).
\item Assume that for ideals of the form~$\aaa = (f(k))_{k < n}$, where~$f$
is a map~${{\downarrow}(n)} \to A$, we have~$1 \not\in \aaa$ or~$\neg(1
\not\in \aaa)$. Then the ideal~$\mmm$ is detachable. If furthermore~$1 \in \aaa$
or~$1 \not\in \aaa$ for such ideals, then~$\mmm$ is maximal in the
strong sense.
\end{enumerate}
\end{proposition}

\begin{proof}The proofs of the countable case carry over word for word.
\end{proof}


\section{For general rings}
\label{sect:wlog}

The construction in Section~\ref{sect:constr} of a maximal ideal applies to
countable rings. In absence of the axiom of choice, some restriction on the
rings is required, as it is well-known that the statement that any nontrivial
ring has a maximal ideal implies (over Zermelo--Fraenkel set
theory~\textsc{zf}) the axiom of choice~\cite{scott:prime-ideals,hodges:krull,banaschewski:krull,erne:krull,howard-rubin:ac}.

However, this limitation only pertains to the abstract existence of maximal
ideals, not to concrete consequences of their existence. Mathematical
logic teaches us by way of diverse examples to not conflate these two concerns. For
instance, although~\textsc{zf} does not prove the axiom of choice, it does
prove every theorem of~\textsc{zfc} pertaining only to natural numbers (by
interpreting the given~\textsc{zfc}-proof in the constructible universe~$L$
and exploiting that the natural numbers are absolute between~$V$
and~$L$~\cite{goedel:ac-gch,schoenfield:predicativity}); similarly, although intuitionistic Zermelo--Fraenkel set
theory,~\textsc{izf}, does not prove the law of excluded middle, it does prove
every~$\Pi^0_2$-theorem of~\textsc{zf} (by the double negation translation
combined with Friedman's trick of the nontrivial exit continuation~\cite{friedman:double-negation-translation}).

A similar phenomenon occurs with countability. Set theory teaches us that
whether a given set is countable depends not only on the set itself, but is
more appropriately regarded as a property of the ambient universe~\cite{hamkins:multiverse}: Given any
set~$M$, there is an extension of the universe in which~$M$ becomes countable.
Remarkably, the passage to such an extension preserves and reflects
intuitionistic first-order logic~\cite[pp.~36f.]{joyal-tierney:grothendieck}.
Hence we have the metatheorem that \emph{countability assumptions from
intuitionistic proofs of first-order statements can always be mechanically
eliminated.}\footnote{For every set~$M$, there is a certain locale~$X$ (the
\emph{classifying locale of enumerations of~$M$}) which is overt, positive and such
that its constant sheaf~$\underline{M}$ is countable in the sense of the
internal language of the topos of sheaves over~$X$. A given
intuitionistic proof can then be interpreted in this topos~\cite{caramello:preliminaries,maietti:modular,shulman:categorical-logic}; since the constant
sheaf functor preserves first-order logic (by overtness), the
sheaf~$\underline{M}$ inherits any first-order assumptions about~$M$ required
by the proof; and since it also reflects first-order logic (by overtness and
positivity), the proof's conclusion descends to~$M$.\par When we apply the
construction of Section~\ref{sect:constr} internally in this topos, the result
will be a certain sheaf of ideals; it is in that sense that every ring
constructively possesses a maximal ideal. This sheaf will not be constant,
hence not originate from an actual ideal of the given ring; but first-order
consequences of the existence of this sheaf of ideals pass down to the ring.
Details are provided by Joyal and
Tierney~\cite[pp.~36f.]{joyal-tierney:grothendieck} and required background on
pointfree topology and topos theory can be found
in~\cite{blechschmidt:generalized-spaces,johnstone:point,vickers:continuity,vickers:locales-toposes,belanger-marquis:pointless,johnstone:baby-elephant}. A predicative account on the basis of~\cite{maietti:au,vickers:sketches,crosilla:predicativity}
is also possible.} Crucially, the first-order restriction is only on the form
of the statements, not on the form of the proofs. These may use higher-order constructs.

``First-order'' statements are statements which only refer to elements, not to
subsets; for instance, the statements of Proposition~\ref{prop:test-cases} are
first-order and hence also hold without the countability assumption.
In contrast, the statement ``there is a maximal ideal'' is a higher-order
statement; hence we cannot eliminate countability assumptions from proofs of
this statement.

The metatheorem expands the applicability of the construction of
Section~\ref{sect:constr} and underscores the value of its intuitionistic
analysis -- the metatheorem cannot be applied to eliminate countability assumptions from classical proofs.
Taken together, they strengthen the
view of maximal ideals as convenient fictions~\cite[Section~1]{schuster-wessel:krull}. Maximal ideals can
carry out their work by any of the following possibilities:
(1)~For countable (or well-founded) rings, no help is required.
Section~\ref{sect:constr} presents an explicit construction of a maximal ideal.
(2)~For arbitrary rings, the existence of a maximal ideal follows from the
axiom of choice.
(3)~Intuitionistic first-order consequences of the existence of a maximal
ideal are true even if no actual maximal ideal can be constructed.

\subsubsection{Acknowledgements}
The present study was carried out within the project ``Reducing complexity in
algebra, logic, combinatorics -- REDCOM'' belonging to the program ``Ricerca
Scientifica di Eccellenza 2018'' of the Fondazione Cariverona and the Gruppo
Nazionale per le Strutture Algebriche, Geometriche e le loro Applicazioni
(GNSAGA) of the Italian Istituto Nazionale di Alta Matematica (INdAM).%
\footnote{The opinions expressed in this paper are solely those of the
authors.} This paper would not have come to existence
without the authors' discussions with Daniel Wessel.

\bibliographystyle{splncs04}
\bibliography{main}

\end{document}

cite?
https://mileti.math.grinnell.edu/research/ideals.pdf
https://homepages.ecs.vuw.ac.nz/~downey/ideals_talk.ps
https://mathoverflow.net/a/229105/31233



The remainder of this section is devoted to spelling out
Theorem~\ref{thm:elim-countability-assumption-informal}. We choose a
topos-theoretic presentation instead of a set-theoretic one because it is more
amenable to syntactic unwindings. The main reference is Joyal and
Tierney's 1984 monograph~\cite{joyal-tierney:grothendieck}; for surveys of the
required background on pointfree topology and topos theory, we refer
to~\cite{blechschmidt:generalized-spaces,johnstone:art,johnstone:point,vickers:continuity,vickers:locales-toposes,belanger-marquis:pointless,johnstone:baby-elephant}.

\begin{thm}[Joyal--Tierney~\cite{joyal-tierney:grothendieck}]\label{thm:locale-enum}
For every inhabited set~$X$, there is a certain locale which is
\begin{enumerate}
\item overt,
\item positive, and such that
\item its constant sheaf~$\underline{X}$ is countable.
\end{enumerate}
\end{thm}

\begin{proof}The locale with these properties is the \emph{classifying locale
of enumerations of~$X$}. This locale has as basic opens the finite
nonempty lists~$[x_0,\ldots,x_n]$, pictured as ``the open of those surjections~$f : \NN \to
X$ such that~$f(i) = x_i$ for~$i = 0,\ldots,n$'', and as generating coverings
\begin{align*}
  [x_0,\ldots,x_n] &= \bigvee_{y \in X} [x_0,\ldots,x_n,y]
  && \text{(for every~$x_0,\ldots,x_n \in X$),} \\
  [x_0,\ldots,x_n] &= \bigvee_{\substack{m \geq 0 \\ x_{n+1},\ldots,x_{n+m} \in
  X \\ x \in \{ x_0,\ldots,x_{n+m} \}}} [x_0,\ldots,x_{n+m}]
  && \text{(for every~$x_0,\ldots,x_n,x \in X$)}. \\
\end{align*}
It is overt because all of these generating coverings are inhabited, and it is
positive (meaning that the canonical map to the one-point locale is surjective)
because there is at least one basic open since~$X$ is inhabited. Details are
provided by Joyal and Tierney~\cite[pp.~36f.]{joyal-tierney:grothendieck}.
\end{proof}

\begin{thm}\label{thm:elim-countability-assumption-formal}Every intuitionistic
proof of a first-order statement in the language of rings, from arbitrary
first-order assumptions and also the assumption that the ring is countable, can
be mechanically transformed to a proof of the same kind without the
countability assumption.\end{thm}

\begin{proof}Let~$p$ be a given such proof. The transformed proof proceeds as
follows. Let~$A$ be an arbitrary ring.
By Theorem~\ref{thm:locale-enum},
there is an open surjective geometric morphism~$f$ from a certain
topos~$\mathcal{E}$ to the
topos of sets such that~$f^*(A)$ is countable.

Assume that~$A$ satisfies all of the
first-order assumptions of~$p$. Since~$f$ is open, the pullback~$f^*(A)$
inherits these assumptions.
Since~$f^*(A)$ is countable from the point of view
of~$\mathcal{E}$ and since~$\mathcal{E}$ supports intuitionistic reasoning, the
proof~$p$ is applicable to~$f^*(A)$. Hence the conclusion of~$p$ holds
for~$f^*(A)$. Since~$f$ is open and surjective, the conclusion descends to~$A$.
\end{proof}

\begin{proposition}\label{prop:nilp-coefficients}Let~$f \in A[X]$ be a polynomial with at least one coefficient
which is not nilpotent. Then~$f$ is not nilpotent in~$A[X]$.
\end{proposition}

\begin{proof}By Proposition~\ref{prop:nilp-prime}, there is a prime ideal
$\ppp \subseteq A$ not containing one of the coefficients of~$f$. Hence~$f$ is
not zero over~$A/\ppp$. Since~$\ppp$ is a prime ideal, the quotient
ring~$A/\ppp$ is an integral domain (in the sense that if~$xy = 0$ and~$x \neq
0$, then~$y = 0$), and since~$\ppp$ is double negation stable, the quotient ring~$(A/\ppp)[X]$ is as well. Thus~$f$ is not nilpotent
as an element of~$(A/\ppp)[X]$ and a fortiori not nilpotent as an element
of~$A[X]$.\end{proof}

XXX link to Agda development

\item for every set~$M \subseteq I$ which is \emph{progressive} or
\emph{hereditary} in the sense that
\[ \forall n \in I\_
  (\forall m \in I\_ m < n \Rightarrow m \in M) \Longrightarrow n \in M, \]
we have~$M = I$, and

XXX not inductively defined
