\documentclass[12pt,oneside,reqno]{amsart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsthm,mathtools,stmaryrd,amssymb,graphicx}
\usepackage{booktabs}
\usepackage[all]{xy}
\usepackage[protrusion=true,expansion=true]{microtype}
\usepackage{xspace}
\usepackage{hyperref}

\title{Maximal ideals in countable rings, constructively}
\author{}
\email{}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{ex}[defn]{Example}
\newtheorem{constr}[defn]{Construction}

\theoremstyle{plain}
\newtheorem{prop}[defn]{Proposition}
\newtheorem{cor}[defn]{Corollary}
\newtheorem{lemma}[defn]{Lemma}
\newtheorem{thm}[defn]{Theorem}
\newtheorem{scholium}[defn]{Scholium}

\theoremstyle{remark}
\newtheorem{rem}[defn]{Remark}
\newtheorem{question}[defn]{Question}
\newtheorem{speculation}[defn]{Speculation}
\newtheorem{caveat}[defn]{Caveat}
\newtheorem{conjecture}[defn]{Conjecture}

\newenvironment{indentblock}{%
  \list{}{\leftmargin\leftmargin}%
  \item\relax
}{%
  \endlist
}

\newcommand{\aaa}{\mathfrak{a}}
\newcommand{\bbb}{\mathfrak{b}}
\newcommand{\mmm}{\mathfrak{m}}
\newcommand{\nnn}{\mathfrak{n}}
\newcommand{\ppp}{\mathfrak{p}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\PRA}{\textsc{pra}}
\newcommand{\ZF}{\textsc{zf}}
\newcommand{\IZF}{\textsc{izf}}
\newcommand{\IZFS}{\textsc{izf/s}}
\newcommand{\CZF}{\textsc{czf}}
\newcommand{\ZFC}{\textsc{zfc}}
\newcommand{\ZFCS}{\textsc{zfc/s}}
\newcommand{\ZFCI}{\textsc{zfc+i}}
\newcommand{\RRS}{\textsc{rrs}}
\newcommand{\RDC}{\textsc{rdc}}
\newcommand{\DC}{\textsc{dc}}
\newcommand{\MDC}{\textsc{mdc}}
\newcommand{\ES}{(\IZF+\RRS_2)/\textsc{s}}
\newcommand{\defeq}{\vcentcolon=}
\renewcommand{\_}{\mathpunct{.}\,}

\begin{document}

\begin{abstract}
  While the existence of a maximal ideal in a general nontrivial commutative
  ring is tied together with the axiom of choice, for countable rings one can
  get by with at most dependent choice. By using the relative interpretation of
  negation (i.e., as ``implies~$0=1$'') we can now, in constructive set theory with
  minimal logic, do without any kind of choice. What we obtain by a functional
  recursive definition is an ideal the quotient of which is a residue field
  (every noninvertible element is zero), and under some decidability
  preconditions even a geometric field (every element is either invertible or
  else zero). Krull's lemma for the related notion of prime ideal follows by
  passing to rings of fractions. All this can be carried over to Heyting
  arithmetic with minimal logic, and to rings indexed by any well-founded set.
  Along the way we do a case study for proofs in algebra with minimal logic.
\end{abstract}


\maketitle
\thispagestyle{empty}


Let~$A$ be a commutative ring with unit. In the spirit of Lombardi and QuittÃ©,
by ``not~$\varphi$'' we mean~$\varphi \Rightarrow 1 = 0 \in A$. Consequently,
by~``$x \not\in M$'' we mean~$x \in M \Rightarrow 1 = 0 \in A$, and a subset~$M
\subseteq A$ is \emph{detachable} if and only if for any~$x \in A$, either~$x \in M$
or~$x \not\in M$. This note is set in the context of minimal logic.

We recall that if~$M \subseteq A$ is an arbitrary subset, not necessarily
detachable, then the ideal~$(M)$ generated by~$M$ can be defined
as \[ (M) = \Bigl\{ \sum_{i=1}^n a_i v_i \,\Big|\, n \geq 0, a_1,\ldots,a_n \in
A, v_1,\ldots,v_n \in M \Bigr\}. \]


\section{A construction}
\label{sect:constr}

We assume that the ring~$A$ is countable, with~$x_0, x_1, \ldots$ an
enumeration of the elements of~$A$. We do \emph{not} assume that~$A$ is
discrete or that it is strongly discrete, that is that finitely generated
ideals of~$A$ are detachable. We also do
\emph{not} assume any form of the axiom of choice.

We study the following recursive construction of ideals~$\mmm_0, \mmm_1,
\ldots$ of~$A$:
\begin{align*}
  \mmm_0 &\defeq \{0\} \\
  \mmm_{n+1} &\defeq \mmm_n + (\{ x_n \,|\, 1 \not\in \mmm_n + (x_n) \}).
\end{align*}
Finally, we set~$\mmm \defeq \bigcup_n \mmm_n$. The construction
of~$\mmm_{n+1}$ from~$\mmm_n$ is uniquely specified, requiring no choices of
any form.

The set~$M_n \defeq \{ x_n \,|\, 1 \not\in \mmm_n + (x_n) \}$ occurring in this
construction contains the element~$x_n$ if and only if~$1 \not\in \mmm_n +
(x_n)$; it is obtained from the singleton set~$\{x_n\}$ by bounded separation.
This set~$M_n$ is empty, and thus~$\mmm_{n+1} = \mmm_n$, precisely when~$1 \in \mmm_n + (x_n)$.
However, in the generality we work in, we cannot assume that~$M_n$ is empty or
inhabited.

The ideal~$(M_n)$ is given by
$(M_n) = \{ a x_n \,|\, a = 0 \vee 1 \not\in \mmm_n + (x_n) \}$.

\begin{prop}The subset~$\mmm$ is an ideal.
\end{prop}

\begin{proof}Directed unions of ideals are ideals.\end{proof}

\begin{prop}\label{prop:proper}
The ideal~$\mmm$ is \emph{proper} in the sense that~$1 \not\in \mmm$.\end{prop}

\begin{proof}Assume~$1 \in \mmm$. Then~$1 \in \mmm_n$ for some number~$n \geq 0$. We
verify~$1 = 0$ by induction over~$n$.

If~$n = 0$, then~$1 \in \mmm_0 = \{0\}$. Hence~$1 = 0$.

If~$n > 0$, then~$1 = u + v x_{n-1}$ for some elements~$u,v \in A$ such that~$u
\in \mmm_{n-1}$ and such that~$v = 0$ or~$1 \not\in \mmm_{n-1} + (x_{n-1})$.
In the first case, we have~$1 = u \in \mmm_{n-1}$, hence~$1 = 0$ by the induction
hypothesis. In the second case we have~$1 = 0$ by modus ponens applied to the
implication~$1 \not\in \mmm_{n-1} + (x_{n-1})$ and the fact~$1 \in \mmm_{n-1} +
(x_{n-1})$ (which follows directly from the equation~$1 = u + v x_{n-1}$).
\end{proof}

\begin{lemma}\label{lemma:stage}
For every number~$n \in \NN$, the following are equivalent:
\begin{enumerate}
\item $x_n \in \mmm_{n+1}$.
\item $x_n \in \mmm$.
\item $1 \not\in \mmm + (x_n)$.
\item $1 \not\in \mmm_n + (x_n)$.
\end{enumerate}
\end{lemma}

\begin{proof}It is clear that~$(3) \Rightarrow (4) \Rightarrow (1) \Rightarrow
(2)$. It remains to show that~$(2) \Rightarrow (3)$.

Assume~$x_n \in \mmm$. In order to verify~$1 \not\in \mmm + (x_n)$,
assume~$1 \in \mmm + (x_n)$. Since~$\mmm + (x_n) \subseteq \mmm$,
we have~$1 \in \mmm$. Hence~$1 = 0$ by Proposition~\ref{prop:proper}.\end{proof}

\begin{prop}\label{prop:is-maximal}The ideal~$\mmm$ is \emph{maximal} in the sense that it is proper and that for
any element~$x \in A$, if $1 \not\in \mmm + (x)$, then~$x \in \mmm$.\end{prop}

\begin{proof}Immediate by Lemma~\ref{lemma:stage}.\end{proof}

The first-order maximality condition of Proposition~\ref{prop:is-maximal} is
equivalent to following higher-order version: For any ideal~$\nnn$ such that~$1
\not\in \nnn$, if~$\mmm \subseteq \nnn$, then~$\mmm = \nnn$.

\begin{cor}The ideal~$\mmm$ is \emph{prime} in the sense that it is proper and that for
any elements~$x,y \in A$, if~$xy \in \mmm$ and~$x \not\in \mmm$, then~$y \in
\mmm$.\end{cor}

\begin{proof}By maximality of~$\mmm$, it suffices to verify that~$1 \not\in
\mmm + (y)$. So assume~$1 \in \mmm + (y)$. Then~$x \in (x) \cdot \mmm + (xy)
\subseteq \mmm$ by~$xy \in \mmm$, hence~$x \in \mmm$, thus~$1 = 0$ by the assumption~$x \not\in
\mmm$.\end{proof}

\begin{cor}The ideal~$\mmm$ is \emph{radical} in the sense that if~$x^k \in
\mmm$, then~$x \in \mmm$.\end{cor}

\begin{proof}Let~$x^k \in \mmm$. Then~$1 \not\in \mmm + (x)$, for if~$1 \in
\mmm + (x)$, then also~$1 = 1^k \in (\mmm + (x))^k \subseteq \mmm + (x^k)
\subseteq \mmm$. Hence~$x \in \mmm$ by Lemma~\ref{prop:is-maximal}.\end{proof}

\begin{rem}The ideal~$\mmm$ is double negation stable in the sense that for any
ring element~$x$, if~$\neg\neg(x \in \mmm)$, then~$x \in \mmm$. This is because
by Lemma~\ref{lemma:stage} membership of~$\mmm$ is a negative condition
and~$\neg\neg\neg\varphi \Rightarrow \neg\varphi$ is a tautology of minimal
logic.\end{rem}

The quotient ring~$A/\mmm$ is a so-called \emph{residue field} (its unit is not
zero, and any element which is not invertible is zero -- as with real or
complex numbers).
XXX incorporate suggestion by Peter

\begin{ex}The resulting maximal ideal~$\mmm$ depends on the chosen enumeration
of~$A$. For instance, if we enumerate~$\ZZ$ by~$0,1,-1,2,-2,\ldots$, the
ideal~$\mmm$ will coincide with~$(2)$. If the enumeration starts with some
prime number~$p$, the ideal~$\mmm$ will coincide with~$(p)$.\end{ex}

\begin{ex}If~$A$ is a local ring (in the sense that if a finite sum of ring
elements is invertible then one of the summands is), then~$\mmm = A \setminus
A^\times$.\end{ex}

If we can decide whether a finitely generated ideal contains the
unit or not, we can improve on this result. (For instance this is the case for
strongly discrete rings such as the ring~$\ZZ$, more generally for the ring of integers of any number
field, and for polynomial rings over discrete fields.)

XXX check claim for polynomial rings

\begin{prop}\label{prop:with-test}
Assume that for any finitely generated ideal~$\aaa \subseteq A$, we have~$1
\not\in \aaa$ or~$\neg(1 \not\in \aaa)$. Then:
\begin{enumerate}
\item Each ideal~$\mmm_n$ is finitely generated.
\item The ideal~$\mmm$ is detachable.
\end{enumerate}
Assume furthermore that or any finitely generated ideal~$\aaa \subseteq
A$, we have~$1 \in \aaa$ or~$1 \not\in \aaa$. Then:
\begin{enumerate}
\addtocounter{enumi}{2}
\item The ideal~$\mmm$ is maximal in the strong sense that for any element~$x
\in A$,~$x \in \mmm$ or~$1 \in \mmm + (x)$, which is to say that the quotient ring~$A/\mmm$ is a
\emph{geometric field} (any element is zero or invertible).
\end{enumerate}
\end{prop}

\begin{proof}We verify claim~$(1)$ by induction over~$n$. The case~$n = 0$ is
clear. Let~$n > 0$. By the induction hypothesis, the ideal~$\mmm_{n-1}$ is finitely
generated, hence so is~$\mmm_{n-1} + (x_{n-1})$. By assumption,~$1 \not\in \mmm_{n-1} +
(x_{n-1})$ or~$\neg(1 \not\in \mmm_{n-1} + (x_{n-1}))$. In the first
case~$\mmm_n = \mmm_{n-1} + (x_{n-1})$. In the second case~$\mmm_n =
\mmm_{n-1}$. In both cases
the ideal~$\mmm_n$ is finitely generated.

To verify claim~(2), let an element~$x_n \in A$ be given. By assumption,~$1
\not\in \mmm_n + (x_n)$ or~$\neg(1 \not\in \mmm_n + (x_n))$. Hence~$x_n \in
\mmm$ or~$x_n \not\in \mmm$ by Lemma~\ref{lemma:stage}.

Finally, to verify claim~(3), let an element~$x_n \in A$ be given. By
assumption,~$1 \in \mmm_n + (x_n)$ or~$1 \not\in \mmm_n + (x_n)$. In the first
case~$1 \in \mmm + (x_n)$. In the second
case~$x_n \in \mmm$ by Lemma~\ref{lemma:stage}.
\end{proof}

It is somewhat remarkable that the ideal~$\mmm$ is detachable even though in
general it is not finitely generated. Usually in constructive mathematics, ideals which are not
finitely generated are seldom detachable. For instance the ideal~$\{ x \in
\ZZ \,|\, x = 0 \vee \varphi \} \subseteq \ZZ$ is detachable if and only
if~$\varphi \vee \neg\varphi$.

\begin{rem}\label{rem:via-generators}There is an equivalent description of the
maximal ideal~$\mmm$ which uses sets~$G_n$ of generators as proxies for the
intermediate ideals~$\mmm_n$:
\begin{align*}
  G_0 &\defeq \emptyset \\
  G_{n+1} &\defeq G_n \cup \{ x_n \,|\, 1 \not\in (G_n \cup \{ x_n \}) \}
\end{align*}
An induction establishes the relation~$(G_n) = \mmm_n$; setting~$G \defeq
\bigcup_{n\in\NN} G_n$, the analogue of Lemma~\ref{lemma:stage} states
that for every number~$n \in \NN$, the following are equivalent:
\begin{enumerate}
\item $x_n \in G_{n+1}$.
\item $x_n \in G$.
\item $1 \not\in (G) + (x_n)$.
\item $1 \not\in (G_n) + (x_n)$.
\end{enumerate}
In particular, not only do we have that~$(G) = \mmm$, but~$G$ itself is already
an ideal. This description of~$\mmm$ is in a sense more ``economical'' as the
intermediate stages~$G_n$ are smaller (not yet being ideals), faciliating
arithmetization in Section~\ref{sect:arithmetization}.
\end{rem}


\section{On the intersection of all prime ideals}

Classically, we have that the intersection of all prime ideals is the
nilradical. In our setup, we have the following substitute:
XXX cite Krull1929

\begin{prop}\label{prop:nilp-prime}Let~$x \in A$ be an element which is not nilpotent. Then there is a
prime ideal~$\ppp \subseteq A$ such that~$x \not\in \ppp$.
\end{prop}

\begin{proof}The localization~$A[x^{-1}]$ is again countable, hence the
construction of Section~\ref{sect:constr} can be carried out to obtain a
maximal (and hence prime) ideal~$\mmm \subseteq A[x^{-1}]$. Any negation
occurring in the terms ``maximal ideal'' and ``prime ideal'' refers to~$1 = 0$
in~$A[x^{-1}]$. Because~$x$ is assumed to be not nilpotent, this is equivalent
to~$1 = 0$ in~$A$. Hence negation with reference to~$A[x^{-1}]$ means the same
as negation with reference to~$A$.

The preimage of~$\mmm$ under the localization homomorphism~$A \to A[x^{-1}]$ is
a prime ideal of~$A$ which doesn't contain~$x$.
\end{proof}

\begin{rem}A closer inspection of the proof of
Proposition~\ref{prop:nilp-prime} reveals that for any element~$x \in A$
(irrespective of whether it is nilpotent), there is an ideal~$\ppp \subseteq A$
such that~$x \in \ppp$ if and only if~$x$ is nilpotent. This ideal is a radical ideal. However, it is
prime only in the following weak sense: If~$1 \in \ppp$, then~$x$ is nilpotent;
and if~$a \in \ppp$ implies that~$x$ is nilpotent, then~$ab \in \ppp \wedge b
\in \ppp$ implies that~$x$ is nilpotent.
\end{rem}

XXX ... often-used case study (cite ...) ...

\begin{prop}Let~$f \in A[X]$ be a polynomial which is nilpotent in~$A[X]$. Then
all coefficients of~$f$ are nilpotent in~$A$.
\end{prop}

\begin{proof}[XXX I currently believe this will work as well.]
\end{proof}

\begin{prop}\label{prop:nilp-coefficients}Let~$f \in A[X]$ be a polynomial with at least one coefficient
which is not nilpotent. Then~$f$ is not nilpotent in~$A[X]$.
\end{prop}

\begin{proof}By Proposition~\ref{prop:nilp-prime}, there is a prime ideal
$\ppp \subseteq A$ not containing one of the coefficients of~$f$. Hence~$f$ is
not zero over~$A/\ppp$. Since~$\ppp$ is a prime ideal, the quotient
ring~$A/\ppp$ is an integral domain (in the sense that if~$xy = 0$ and~$x \neq
0$, then~$y = 0$), and since~$\ppp$ is double negation stable, the quotient ring~$(A/\ppp)[X]$ is as well. Thus~$f$ is not nilpotent
as an element of~$(A/\ppp)[X]$ and a forteriori not nilpotent as an element
of~$A[X]$.\end{proof}


\section{In Heyting arithmetic}
\label{sect:arithmetization}

The construction presented in Section~\ref{sect:constr} crucially rests on the
flexibility of subsets of the given ring~$A$: In the absence of additional
assumptions as in Proposition~\ref{prop:with-test},
we cannot make do with decidable
predicates~$A \to 2$; without additional hypotheses on~$A$, membership of the
resulting maximal ideal~$\mmm$ is not decidable. As such, the construction is
naturally formalized in intuitionistic set theories such as~\textsc{czf}
or~\textsc{izf}, which natively support such flexible subsets.

In this section, we explain how with some more care, the construction can also
be carried out in much weaker foundations such as Heyting
arithmetic~\textsc{ha}. While formulation in classical Peano arithmetic~\textsc{pa}
is routine, the development in~\textsc{ha} crucially rests on a specific
feature of the construction, namely that the condition for membership is a
negative condition.

To set the stage, we specify what we mean by a \emph{ring} in the context of
arithmetic. One option would be that an arithmetized ring should be a single
natural number coding a finite set of ring elements and the graphs of the
corresponding ring operations; however, this perspective is too narrow, as we
also want to entertain infinite rings.

Instead, an arithmetized ring should be given by a ``formulaic setoid with ring
structure'', that is: by a formula~$A(n)$ with free
variable~$n$, singling out which natural numbers constitute
representants of the ring elements; by a formula~$E(n,m)$ describing which
representants are deemed equivalent; by a formula~$Z(n)$ singling out
representants of the zero element; by a formula~$P(n,m,s)$ singling out
representants~$s$ of sums; and so on with the remaining data constituting
a ring; such that axioms such as
\begin{align*}
  \forall n\_ & Z(n) \Rightarrow A(n) && \text{``any zero representant belongs to the ring''} \\
  \exists n\_ & Z(n) && \text{``there is a zero representant''} \\
  \forall n,m\_ & Z(n) \wedge Z(m) \Longrightarrow E(n,m) && \text{``any two zero representants are equivalent''} \\
  \forall z,n\_ & Z(z) \wedge A(n) \Longrightarrow P(z,n,n) && \text{``zero is neutral with respect to addition''}
\end{align*}
hold. Although first-order arithmetic cannot quantify over ideals of such
rings, specific ideals can be given by formulas~$I(n)$ such that
\begin{align*}
  \forall n\_ & I(n) \Rightarrow A(n) && \text{``$I \subseteq A$''} \\
  \exists n\_ & Z(n) \Rightarrow I(n) && \text{``$0 \in I$''}
\end{align*}
hold. It is in this sense that we are striving to adapt the construction of
Section~\ref{sect:constr} to describe a maximal ideal.

In this context, we can arithmetically imitate any set-theoretic description of
an ideal (as a subset cut out by an explicit first-order formula). However, for
recursively defined families of ideals, we require a suitable recursion
theorem: If we are given (individual formulas~$M_i(x)$ indexed by numerals
representing) ideals~$\mmm_0,\mmm_1,\mmm_2,\ldots$, we cannot generally
form~$\bigcup_{n\in\NN} \mmm_n$, as the naive formula~$\bigvee_{n\in\NN} M_n(x)$
representing this union would have infinite length. We can take the union only
if the family is \emph{uniformly represented} by a formula~$M(n,x)$ (denoting
that~$x$ represents an element of~$\mmm_n$).

It is here that we encounter a stumbling block in arithmetizing the
construction of the ascending chain~$\mmm_0 \subseteq \mmm_1 \subseteq \cdots$
of Section~\ref{sect:constr}. Because~$\mmm_n$ occurs in the
definition of~$\mmm_{n+1}$ in negative position, a naive arithmetization
results in formulas of unbounded logical complexity, suggesting that
a uniform definition might not be possible.

This issue does not arise in the context of~\textsc{pa}, where the law of
excluded middle allows us keep the logical complexity bounded: We can define
the joint indicator function~$g(n,i)$ for the sets~$G_n$ (such that~$G_n = \{
x_i \,|\, i \in \NN, g(n,i) = 1 \}$) of Remark~\ref{rem:via-generators} by the recursion
\begin{align*}
  g(0,x) &= 0 \\
  g(n+1,i) &= \begin{cases}
    1, & \text{if $g(n,i) = 1 \vee (i = n \wedge 1 \not\in
    (g(n,0)x_0,\ldots,g(n,n-1)x_{n-1},x_n))$} \\
    0, & \text{else.}
  \end{cases}
\end{align*}
This recursion can be carried out within~\textsc{pa} since the recursive step
only references the finitely many values~$g(n,0),\ldots,g(n,n-1)$.

Heyting arithmetic, however, does not support this case distinction. The
formalization of the construction in~\textsc{ha} is unlocked by the following
observation.

\begin{lemma}\label{lemma:uniform-char}(In the situation of Remark~\ref{rem:via-generators}.)
For any finite binary sequence~$v = [v_0,\ldots,v_{n-1}]$, set~$\aaa_v
\defeq (v_0x_0,\ldots,v_{n-1}x_{n-1},x_n)$. Then:
\begin{enumerate}
\item For any such sequence~$v = [v_0,\ldots,v_{n-1}]$, if
\[ \bigwedge_{i=0}^{n-1} (v_i = 1 \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]}), \]
then~$\aaa_v = (G_n) + (x_n)$.
In particular~$x_n \in G$ if and only if~$1 \not\in \aaa_v$.
\item For every natural number~$n \in \NN$,
\[ x_n \in G \quad\Longleftrightarrow\quad \neg
  \exists v \in \{0,1\}^n\_
    1 \in \aaa_v \wedge
      \bigwedge_{i=0}^{n-1} (v_i = 1 \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]}). \]
\end{enumerate}
\end{lemma}

\begin{proof}The first part is by induction, employing the equivalences of
Remark~\ref{rem:via-generators}. The second rests on the tautology
\[ \neg\alpha \quad\Longleftrightarrow\quad \neg(\alpha \wedge (\varphi \vee \neg\varphi)) \]
of minimal logic and follows by the following computation:
\begin{align*}
  &\mathrel{\phantom{\Longleftrightarrow}} x_n \in G \\
  &\Longleftrightarrow \neg\bigl(1 \in (G_n) + (x_n)\bigr) \\
  &\Longleftrightarrow \neg\bigl(1 \in (G_n) + (x_n) \ \wedge\ \bigwedge_{i=0}^{n-1} (x_i \in G \vee x_i \not\in G)\bigr) \\
  &\Longleftrightarrow \neg\exists v \in \{0,1\}^n\_
    \Bigl(1 \in (G_n) + (x_n) \ \wedge\ \bigwedge_{i=0}^{n-1} (v_i = 1
    \Leftrightarrow x_i \in G)\Bigr) \\
  &\Longleftrightarrow \neg\exists v \in \{0,1\}^n\_
    \Bigl(1 \in \aaa_v \ \wedge\ \bigwedge_{i=0}^{n-1} (v_i = 1
    \Leftrightarrow 1 \not\in \aaa_{[v_0,\ldots,v_{i-1}]})\Bigr) \qedhere
\end{align*}
\end{proof}

Condition~(2) in Lemma~\ref{lemma:uniform-char} is manifestly formalizable in
arithmetic, uniformly in~$n$.


\section{For general rings}

The construction in Section~\ref{sect:constr} of a maximal ideal applies to
countable rings. In absence of the axiom of choice, some restriction on the
rings is required, as it is well-known that the statement that any nontrivial
ring has a maximal ideal implies (over Zermelo--Fraenkel set
theory~\textsc{zf}) the axiom of choice~\cite{hodges:krull,banaschewski:krull,erne:krull}.

However, this observation only pertains to the abstract existence of maximal
ideals, not to concrete consequences of this assumption. Mathematical
logic teaches us by way of diverse examples to not conflate these concerns. For
instance, although~\textsc{zf} does not prove the axiom of choice, it does
prove any theorem of~\textsc{zfc} pertaining only to natural numbers (by
interpreting the given~\textsc{zfc}-proof in the constructible universe~$L$
and exploiting that the natural numbers are absolute between~$V$ and~$L$,
see~\cite{???}); similarly, although intuitionistic Zermelo--Fraenkel set
theory,~\textsc{izf}, does not prove the law of excluded middle, it does prove
any~$\Pi^0_2$-theorem of~\textsc{zf} (by the double negation translation
combined with Friedman's trick of the nontrivial exit continuation,
\cite{???}).

A similar phenomenon occurs with countability: Set theory teaches us that
whether a given set is countable depends not only on the set itself, but is
more appropriately regarded as a property of the ambient universe -- given any
set~$X$, there is an extension of the universe in which~$X$ becomes countable.

Remarkably, the passage to such an extension preserves and reflects intuitionistic first-order logic.
As a result, we have the following metatheorem (to be restated in precise language
as Theorem~\ref{thm:elim-countability-assumption-formal}):

\begin{thm}\label{thm:elim-countability-assumption-informal}Countability
assumptions from intuitionistic proofs of first-order statements can always be
eliminated.\end{thm}

``First-order'' statements only refer to elements, not to
subsets; for instance, Proposition~\ref{prop:nilp-coefficients} is a
first-order statement and hence holds also without the countability assumption.
In contrast, the statement ``there is a maximal ideal'' is a higher-order
statement; hence we cannot eliminate countability assumptions from proofs of
this statement.

Theorem~\ref{thm:elim-countability-assumption-informal} strengthens the
view of maximal ideals as convenient fictions. They can
carry out their work by any of the following possibilities:
\begin{enumerate}
\item For countable (or well-founded) rings, no help is required.
Section~\ref{sect:constr} presents an explicit construction of a maximal ideal.
\item For arbitrary rings, the existence of a maximal ideal follows from the
axiom of choice.
\item Intuitionistic first-order consequences of the existence of a maximal
ideal are true even if no actual maximal ideal can be constructed.
\end{enumerate}

%their existence requires special assumptions (such as countability,
%well-foundedness or the axiom of choice), their intuitionistic first-order
%consequences hold without any such assumptions.

The remainder of this section is devoted to spelling out
Theorem~\ref{thm:elim-countability-assumption-informal}. We choose a
topos-theoretic presentation instead of a set-theoretic one because it is more
amenable to syntactic unwindings. The main reference is Joyal and
Tierney's 1984 monograph~\cite{joyal-tierney:grothendieck}; for surveys of the
required background on pointfree topology and topos theory, we refer
to~\cite{blechschmidt:generalized-spaces,johnstone:art,johnstone:point,vickers:continuity,vickers:locales-toposes,belanger-marquis:pointless,johnstone:baby-elephant}.

\begin{thm}[Joyal--Tierney~\cite{joyal-tierney:grothendieck}]\label{thm:locale-enum}
For any inhabited set~$X$, there is a certain locale which is
\begin{enumerate}
\item overt,
\item positive, and such that
\item its constant sheaf~$\underline{X}$ is countable.
\end{enumerate}
\end{thm}

\begin{proof}The locale with these properties is the \emph{classifying locale
of enumerations of~$X$}. This locale has as basic opens the finite
nonempty lists~$[x_0,\ldots,x_n]$, pictured as ``the open of those surjections~$f : \NN \to
X$ such that~$f(i) = x_i$ for~$i = 0,\ldots,n$'', and as generating coverings
\begin{align*}
  [x_0,\ldots,x_n] &= \bigvee_{y \in X} [x_0,\ldots,x_n,y]
  && \text{(for any~$x_0,\ldots,x_n \in X$),} \\
  [x_0,\ldots,x_n] &= \bigvee_{\substack{m \geq 0 \\ x_{n+1},\ldots,x_{n+m} \in
  X \\ x \in \{ x_0,\ldots,x_{n+m} \}}} [x_0,\ldots,x_{n+m}]
  && \text{(for any~$x_0,\ldots,x_n,x \in X$)}. \\
\end{align*}
It is overt because all of these generating coverings are inhabited, and it is
positive (meaning that the canonical map to the one-point locale is surjective)
because there is at least one basic open since~$X$ is inhabited. Details are
provided by Joyal and Tierney~\cite[pp.~36f.]{joyal-tierney:grothendieck}.
\end{proof}

When we apply the construction of Section~\ref{sect:constr} internally in the
topos of sheaves over the locale of Theorem~\ref{thm:locale-enum}, the result
will be a certain sheaf of ideals. This sheaf will not be constant, hence not
originate from an actual ideal of the given ring; but first-order consequences
of the existence of this sheaf of ideals pass down to the ring.

\begin{thm}\label{thm:elim-countability-assumption-formal}Any intuitionistic
proof of a first-order statement in the language of rings, from arbitrary
first-order assumptions and also the assumption that the ring is countable, can
be mechanically transformed to a proof of the same kind without the
countability assumption.\end{thm}

\begin{proof}Let~$p$ be a given such proof. The transformed proof proceeds as
follows. Let~$A$ be an arbitrary ring.
By Theorem~\ref{thm:locale-enum},
there is an open surjective geometric morphism~$f$ from a certain
topos~$\mathcal{E}$ to the
topos of sets such that~$f^*(A)$ is countable.

Assume that~$A$ satisfies all of the
first-order assumptions of~$p$. Since~$f$ is open, the pullback~$f^*(A)$
inherits these assumptions.
Since~$f^*(A)$ is countable from the point of view
of~$\mathcal{E}$ and since~$\mathcal{E}$ supports intuitionistic reasoning, the
proof~$p$ is applicable to~$f^*(A)$. Hence the conclusion of~$p$ holds
for~$f^*(A)$. Since~$f$ is open and surjective, the conclusion descends to~$A$.
\end{proof}


\section{Generalization to the well-founded case}

In this section, we relax the assumption that the ring~$A$ is countable to the
assumption that~$A$ is the image of a well-founded set~$I$. There are several
definitions of well-foundedness in the literature; we get by with the following
weak requirement: There is a transitive relation~$({<})$ on~$I$ such that
\begin{enumerate}
\item for any class~$M \subseteq I$ which is \emph{progressive} or
\emph{hereditary} in the sense that
\[ \forall n \in I\_
  (\forall m \in I\_ m < n \Rightarrow m \in M) \Longrightarrow n \in M, \]
we have~$M = I$, and
\item both~$I$ and any subset of the form~$\{k \in I \,|\, k < n\}$ which is
inhabited are directed.
% for any elements~$a,b,c \in I$, if~$a < c$ and~$b < c$, then there is an
% element~$w \in I$ such that~$a,b \leq w < c$.
\end{enumerate}
Condition~(2) is for instance satisfied if~$({<})$ is a linear order.

XXX check whether we want class or set?

We write~$A = \{ x_n \,|\, n \in I \}$.
We propose the following recursive construction of ideals~$\mmm_n$, $n \in I$:
\begin{align*}
  \mmm_n &\defeq \mmm_{<n} + (\{ x_n \,|\, 1 \not\in \mmm_{<n} + (x_n) \}),
\end{align*}
where~$\mmm_{<n} \defeq \sum_{k < n} \mmm_k$. We set~$\mmm \defeq \bigcup_{n
\in I} \mmm_n$. As before, no choices of any kind are required.

\begin{prop}\begin{enumerate}
\item The set~$\mmm$ is an ideal.
\item The ideal~$\mmm$ is proper.
\item For an element~$x_n \in A$, the following are equivalent: (a) $x_n \in
\mmm_{n+1}$; (b) $x_n \in \mmm$; (c) $1 \not\in \mmm + (x_n)$; (d) $1 \not \in \mmm_n + (x_n)$.
\item The ideal~$\mmm$ is maximal (and hence prime).
\end{enumerate}
\end{prop}

\begin{proof}The proofs of the countable case carry over word for word.
\end{proof}

We also have an analogue of Proposition~\ref{prop:with-test}, requiring that
for ideals of the form~$\aaa = (f(k))_{k < n}$, where~$f$ is a map~$\{ k \in I
\,|\, k < n \} \to A$, we have~$1 \in \aaa$ or~$1 \not\in \aaa$. However, we
don't know how useful this analogue is.

\end{document}

cite?
https://mileti.math.grinnell.edu/research/ideals.pdf
https://homepages.ecs.vuw.ac.nz/~downey/ideals_talk.ps
https://mathoverflow.net/a/229105/31233


hodges:krull
Wilfrid Hodges, Krull implies Zorn, J. London Math. Soc. (2) 19 (1979), no. 2,
285--287.

banaschewski:krull
Bernhard Banaschewski, A new proof that âKrull implies Zornâ, Math. Logic
Quart. 40 (1994), no. 4, 478--480.

erne:krull
Marcel ErnÃ©, A primrose path from Krull to Zorn, Comment. Math. Univ. Carolin.
36 (1995), no. 1, 123â-126.

joyal-tierney:grothendieck

XXX: subquotient!
